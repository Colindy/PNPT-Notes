### AntiVirus Evasion

Anti-virus works in a number of different ways.  Starting out as purely signature based, it made decisions based on different signatures that it knew.  Comparing traffic to those signatures was how it determined if what it was comparing was malicious.

Depending on the AV engine, these signatures can vary greatly, even for the same piece of malware.  One signature may deal with the malware stored on a hard drive and another may deal with the malware while it's in transmission on the network.

VirusTotal can be a good resource to check binaries against.  But, do note that any file submitted to VirusTotal is considered Public upon submission.  One other option that claims to not share these details is a site called `https://www.kleenscan.com`.  Does very close to what VirusTotal does but claims to not share what they recieve.  Either way, this should really be a last resort.

Beyond that though, VirusTotal can give you a wealth of information about a file that was uploaded in the behavior tab.  It may take a sec to run but it's worth the wait.

#### On-Disk Evasion

`packers` were used in the early times as a way to compress executables.  Not just like a ZIP file, these would actually generate an executable that was smaller but did the same thing as the original source code.  This would also change the hash making it an effective way to bypass signature based AV models of the time.

`obfuscators` change and mutate code.  They can even add irrelevant bits of code called `dead code`.  They can split and reorder functions, or replace bits of code with different code but will get the same output.  Used a lot by developers to protect IP, it's decent against signature based AVs.  Some modern ones even have `runtime in-memory` capabilities, making it even harder for AV to detect.

`crypter` software can encrypt exectuable code and add a decryption stub to restore code upon execution.  Since the decryption happens in memory, this avoids AV detection from scanners of storage.

#### In-Memory Evasion

`In-Memory Injection`, or PE Injection, plants the payload directly into volitile memory and never writes anything to the hard drive.  There are a number of these but some go into C/C++ programing.

`Reflective DLL Injection` attempts to load a DLL in the process memory instead of loading it from the disk.  This is difficult due to the fact that no Windows APIs that could take those are exposed.

`Process Hollowing` involves launching a non-malicious process in a suspended state.  Then removing the image of the process from memory and replacing it with the payload.  Then the process is resumed and the payload triggers.

#### Testing for AV Evasion

You could use the tools mentioned above, VirusTotal or Kleenscan (likely to stick with Kleenscan depending on what you are looking at as VirusTotal shares what is submitted to them).

Ideally, you want to build a VM that mimics your target as closely as possible.