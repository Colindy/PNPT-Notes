### SMTP Enumeration

Simple Mail Transfer Protocol (SMTP)

SMTP supports several commands, like `VRFY` (to verify an email) and `EXPN` (asks for the membership of a mailing list).

For a full list of all the commands and response codes, `https://mailtrap.io/blog/smtp-commands-and-responses/` has a listing of them.

The following python script can be used to check a given username against an SMTP server.

```
#!/usr/bin/python

import socket
import sys

if len(sys.argv) != 3:
        print("Usage: vrfy.py <username> <target_ip>")
        sys.exit(0)

# Create a Socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the Server
ip = sys.argv[2]
connect = s.connect((ip,25))

# Receive the banner
banner = s.recv(1024)

print(banner)

# VRFY a user
user = (sys.argv[1]).encode()
s.send(b'VRFY ' + user + b'\r\n')
result = s.recv(1024)

print(result)

# Close the socket
s.close()
```

We can also obtain this with a windows machine using the following `Test-NetConnection -Port 25 192.168.50.8` (this is also how we tested different ports in the nmap and nc section).  While this is limited, if we have telnet then we can telnet in.

We can either `dism /online /Enable-Feature /FeatureName:TelnetClient` (this requires admin and may be inaccessible), or we can grab the executable (the .exe file) from `c:\windows\system32\telnet.exe` and transfer it to the device we're trying to telnet from.

Then we `telnet 192.168.50.8 25` and telnet into the device via SMTP.