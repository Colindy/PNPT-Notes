### Attacking Login Portals

Overview and Strategy  
&ensp;Should have a list of possible employees at this point  
&ensp;Trying passwords with current season and year and other common ones  
&ensp;&ensp;Can also back date since some places don't have 90 day password expire  
&ensp;&ensp;Location, sports teams, address numbers, etc  
&ensp;Verifying correct emails with login portals if possible  
&ensp;Make sure you know about any lockout policy so as to not lock accounts  

Attacking O365  
&ensp;Password spraying - Using multiple accounts with some common passwords.  
&ensp;If you can get account info from O365, then AD is likely the same with the username as the email or without the @company.com extension.  
&ensp;&ensp;Tools  
&ensp;blacklanternsecurity / TREVORspray - github  
&ensp;&ensp;`pip install git+https://github.com/blacklanternsecurity/trevorproxy`  
&ensp;&ensp;&ensp;Some interesting options  
&ensp;&ensp;&ensp;&ensp;-e will take a list of emails, validate it and then go forward with trying passwords, bypassing invalid emails.  
&ensp;&ensp;&ensp;&ensp;--passwords  - either a txt doc or 'password' in quotes  
&ensp;&ensp;&ensp;&ensp;--delay 15  - will set a delay of 15 seconds between each attempt  
&ensp;&ensp;&ensp;&ensp;--no-current-ip --ssh   - Will use ssh to try each attempt from a differernt device, depending on how many devices you want to cycle through.  Does require some setup.  
&ensp;&ensp;&ensp;&ensp;In order to set this up, you can use AWS, free tier machines.  Create one and then duplicate that one.  Set all to same key pair.  Verify the login manually from the same device before starting the tool and accept the fingerprint or the tool will break.  
&ensp;&ensp;&ensp;&ensp;-k keypair.pem    - this will follow the list of machines to ssh into (ubuntu@publicIP) and this will enable the use of multiple devices.  

Attacking OWA  
&ensp;Metasploit has OWA attacks.  Search will give you `auxiliary/scanner/http/owa_login`  
&ensp;&ensp;This can be used for spraying and stuffing.  
&ensp;&ensp;`show options` give you a number of options to use  
&ensp;&ensp;Not as often to get blocked with OWA  
&ensp;&ensp;May need to change Auxiliary Action to different OWA version  
&ensp;&ensp;This will also give you a list of usernames that have been validated  
&ensp;&ensp;Will not auto stop if accounts lock out so keep an eye on this  

Attacking Other Portals  
&ensp;Burpsuite Intruder can be used for items that are not Outlook/Microsoft related.  
&ensp;&ensp;Checking things like response code and response size can point out different results  
&ensp;Again.  Still watch for getting account lockout responses.  

Bypassing MFA  
&ensp;If you are unable to do social engineering, we're limited but there are some tools  
&ensp;&ensp;dafthack / MFASweep   - github  
&ensp;&ensp;&ensp;This tool will go through and see if things have MFA enabled  
&ensp;&ensp;&ensp;Does require having a good account and password  